<?xml version="1.0"?>

<ui:composition xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:c="http://java.sun.com/jstl/core"
      xmlns:onc="http://jboss.org/on/component"
      xmlns:onf="http://jboss.org/on/function"
      xmlns:a4j="https://ajax4jsf.dev.java.net/ajax"
      xmlns:rich="http://richfaces.ajax4jsf.org/rich">

   <rich:panel styleClass="BlockContent">
      <f:facet name="header">
         Recently Installed Packaged
      </f:facet>

      <rich:dataTable id="packagesDataTable"
                      rows="0"
                      value="#{ResourceOverviewUIBean.recentPackageHistory}"
                      var="item"
                      width="100%"
                      columnsWidth="70%, 30%"
                      headerClass="tableRowHeader"
                      footerClass="on-pager-footer"
                      onRowMouseOver="this.style.backgroundColor='#E7E7E7'"
                      onRowMouseOut="this.style.backgroundColor='#{a4jSkin.tableBackgroundColor}'">

         <rich:column>
            <f:facet name="header">
               <h:outputText styleClass="headerText" value="Package Name" />
            </f:facet>
            <h:outputLink value="/rhq/resource/content/audit-trail-item.xhtml">
               <f:param name="id" value="#{item.resource.id}" />
               <f:param name="selectedHistoryId" value="#{item.id}" />
               <h:outputText value="#{item.packageVersion.displayName}" 
                             rendered="#{!empty item.packageVersion.displayName}"/>
               <h:outputText value="#{item.packageVersion.generalPackage.name}" 
                             rendered="#{empty item.packageVersion.displayName}"/>
            </h:outputLink>
         </rich:column>

         <rich:column>
            <f:facet name="header">
               <h:outputText styleClass="headerText" value="Version" />
            </f:facet>
            <h:outputText value="#{item.packageVersion.displayVersion}" />
         </rich:column>

         <rich:column>
            <f:facet name="header">
               <h:outputText styleClass="headerText" value="Timestamp" />
            </f:facet>
            <h:outputText value="#{item.timestamp}">
               <f:converter converterId="RelativeDurationConverter" />
            </h:outputText>
         </rich:column>

          <f:facet name="footer">
             <rich:columnGroup>
                <rich:column colspan="4" width="100%">
                   <h:outputText value="Up to 5 items are shown" 
                                 rendered="#{onf:sizeOf(ResourceOverviewUIBean.recentEventCounts) ne 0}"/>
                   <h:outputText value="This resource has no installed packaged history" 
                                 rendered="#{onf:sizeOf(ResourceOverviewUIBean.recentEventCounts) eq 0}"/>
                </rich:column>
             </rich:columnGroup>
          </f:facet>

      </rich:dataTable>
   </rich:panel>

</ui:composition>
