<?xml version="1.0" encoding="UTF-8"?>

<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:c="http://java.sun.com/jstl/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:a4j="http://richfaces.org/a4j"
                xmlns:rich="http://richfaces.org/rich"
                xmlns:onc="http://jboss.org/on/component">

  <h:outputText value=" #{messages.nopermissionedit}"
                rendered="#{!ResourceUIBean.permissions.configure}"/>

  <h:panelGrid columns="2"
               styleClass="raw-outer-table"
               columnClasses="raw-outer-table-left-col,raw-outer-table-right-col">
    <rich:panel style="width:100%">
      <f:facet name="header">Files</f:facet>
      <rich:panelMenu mode="ajax"
                      expandMode="client"
                      iconCollapsedGroup="/images/icn_tree_folder.gif"
                      iconExpandedGroup="/images/icn_tree_folder.gif"
                      limitToList="true"
                      reRender="fileContents">
        <c:forEach items="#{rawConfigDirectories}"
                   var="rawConfigDir">
          <rich:panelMenuGroup label="#{rawConfigDir.path}"
                               expanded="true"
                               selectedChild="#{currentPath}">
            <c:forEach items="#{rawConfigDir.rawConfigUIBeans}" var="rawConfigUIBean">
              <rich:panelMenuItem label="#{rawConfigUIBean.fileName}"
                                  icon="/images/blank.png"
                                  onclick="cursor_wait();"
                                  oncomplete="cursor_clear();"
                                  action="#{configurationViewer.select(rawConfigUIBean.path)}"
                                  limitToList="true"
                                  reRender="fileContents,selectedFileHeader,modalEditor"/>
            </c:forEach>
          </rich:panelMenuGroup>
        </c:forEach>
      </rich:panelMenu>
    </rich:panel>

    <h:panelGrid columns="1" style="width:100%;">
      <h:panelGrid columns="4" style="width:100%;">
        <h:outputLabel value=" "/>

        <h:outputLink value="#" onclick="#{rich:component('modalEditor')}.show()">View Full Screen</h:outputLink>

        <h:outputLink value="#" onclick="#{rich:component('uploadWindow')}.show()">Upload New</h:outputLink>

        <h:commandLink action="#{configurationViewer.download}" value="Download">
          <h:graphicImage value="/images/download.png"/>
          <f:param name="id" value="#{ResourceUIBean.id}"/>
        </h:commandLink>

        <a4j:status id="selectedFileHeader"
                    startText="Loading #{selectedRawUIBean.path} ..."
                    stopText="#{selectedRawUIBean.path}"/>
      </h:panelGrid>

      <rich:panel style="margin-left:1px; border: none;">
        <h:inputTextarea id="fileContents"
                         style="width:100%"
                         value="#{selectedRawUIBean.contents}"
                         readonly="true"/>
      </rich:panel>
    </h:panelGrid>
  </h:panelGrid>

</ui:composition>