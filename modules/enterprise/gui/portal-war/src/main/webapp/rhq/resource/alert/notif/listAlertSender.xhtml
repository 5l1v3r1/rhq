<?xml version="1.0" encoding="UTF-8"?>

<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:c="http://java.sun.com/jstl/core"
      xmlns:onc="http://jboss.org/on/component"
      xmlns:a4j="http://richfaces.org/a4j"
      xmlns:rich="http://richfaces.ajax4jsf.org/rich">

<ui:composition template="/rhq/layout/main.xhtml">

    <ui:param name="pageTitle" value="List Alert Notifications for Resource '#{ResourceUIBean.name}'"/>

    <ui:define name="metaHeaders">
        <style>
            .col1, .col2 {
                vertical-align: top;
                padding: 10px;
            }
        </style>
    </ui:define>

    <ui:define name="breadcrumbs">
        <h:outputLink value="/alerts/Config.do">
            <f:param name="mode" value="viewRoles"/>
            <f:param name="id" value="#{param.id}"/>
            <f:param name="ad" value="#{param.ad}"/>
            <h:outputText>Alert Definitions</h:outputText>
        </h:outputLink>
        <h:outputText> &gt; </h:outputText>
        <h:outputLink value="listAlertSender.xhtml">
            Alert Sender Definitions
        </h:outputLink>
    </ui:define>

    <ui:define name="body">
        <br/>
        <h:messages showSummary="true"
                    showDetail="true"
                    infoClass="InfoBlock"
                    warnClass="WarnBlock"
                    errorClass="ErrorBlock"
                    fatalClass="FatalBlock"
                    globalOnly="true"
                    layout="table"
                    width="100%"/>

        <rich:panel id="existingAlertsPanel">
            <f:facet name="header">
                <h:outputText>Existing notifications for Resource '#{ResourceUIBean.name}' and alert definition '#{alertNotificationsUIBean.alertDefinition.name}':</h:outputText>
            </f:facet>
            <h:panelGrid columns="2" width="100%" columnClasses="col1,col2">
                <h:panelGroup>
                    <h:form id="notificationListForm">
                        <input type="hidden" name="id" value="${param.id}"/>
                        <input type="hidden" name="ad" value="${param.ad}"/>

                            <rich:orderingList value="#{alertNotificationsUIBean.alertNotifications}"
                                               var="alertSender"
                                               selection="#{alertNotificationsUIBean.selectedNotifications}"
                                               activeItem="#{alertNotificationsUIBean.activeNotification}"
                                               converter="#{alertNotificationsUIBean.notificationConverter}"
                                               listWidth="250">
                                <rich:column>
                                    <f:facet name="header">
                                        <h:outputText value="Alert Sender (Select to Edit)" />
                                    </f:facet>
                                    <h:outputText value="#{alertSender.senderName}" />
                                </rich:column>

                                <a4j:support event="onclick"
                                             ignoreDupResponses="true"
                                             requestDelay="25"
                                             reRender="alertConfig" />
                                <a4j:support event="onkeyup"
                                             ignoreDupResponses="true"
                                             requestDelay="150"
                                             reRender="alertConfig" />
                            </rich:orderingList>
                    </h:form>

                    <h:form id="alertActionButtons">
                        <input type="hidden" name="id" value="${param.id}"/>
                        <input type="hidden" name="ad" value="${param.ad}"/>

                        <h:commandButton id="removeAlertButton"
                                         value="Remove Selected Alerts"
                                         action="#{alertNotificationsUIBean.removeSelected}"
                                         styleClass="buttonmed"/>
                    </h:form>
                </h:panelGroup>

                <h:form id="alertConfig">
                    <input type="hidden" name="id" value="${param.id}"/>
                    <input type="hidden" name="ad" value="${param.ad}"/>

                    <rich:panel rendered="#{not empty alertNotificationsUIBean.activeNotification.configuration.map}">
                        <f:facet name="header">
                            <h:outputText value="#{alertNotificationsUIBean.activeNotification.senderName} Configuration"/>
                        </f:facet>
                        <onc:config configurationDefinition="#{alertNotificationsUIBean.activeConfigDefinition}"
                                    configuration="#{alertNotificationsUIBean.activeNotification.configuration}" />

                        <h:commandButton id="saveConfigButton"
                                 value="SAVE"
                                 action="#{alertNotificationsUIBean.saveConfiguration}"
                                 styleClass="buttonmed"/>
                    </rich:panel>
                </h:form>
            </h:panelGrid>
        </rich:panel>

        <rich:panel id="addAlertPanel">
            <f:facet name="header">
                <h:outputText value="Add Alert Sender" />
            </f:facet>

            <h:form id="newNotificationForm">
                <input type="hidden" name="id" value="${param.id}"/>
                <input type="hidden" name="ad" value="${param.ad}"/>

                <h:selectOneMenu id="senderList" value="#{alertNotificationsUIBean.selectedNewSender}">
                    <f:selectItems value="#{alertNotificationsUIBean.allAlertSenders}" />
                </h:selectOneMenu>

                <h:commandButton id="addAlertButton"
                                 value="Add Alert"
                                 action="#{alertNotificationsUIBean.addAlertSender}"
                                 styleClass="buttonmed">
                </h:commandButton>
            </h:form>
        </rich:panel>

        <br />
        <br />
        <h:outputLink value="/rhq/resource/alert/listAlertDefinitions.xhtml">
            <f:param name="id" value="#{param.id}"/>
            <h:outputText value="Back to Alert Definitions for Resource '#{ResourceUIBean.name}'"/>
        </h:outputLink>
    </ui:define>
</ui:composition>
</html>
