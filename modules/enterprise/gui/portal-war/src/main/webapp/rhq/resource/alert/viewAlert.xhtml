<?xml version="1.0"?>

<!DOCTYPE html
      PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:c="http://java.sun.com/jstl/core"
      xmlns:onc="http://jboss.org/on/component"
      xmlns:onf="http://jboss.org/on/function"
      xmlns:s="http://jboss.com/products/seam/taglib"
      xmlns:a4j="https://ajax4jsf.dev.java.net/ajax"
      xmlns:rich="http://richfaces.ajax4jsf.org/rich">

    <c:choose>
        <c:when test="#{not empty param.type}">
            <c:set var="title" value="Definition for '#{alertDefinition.name}' on resource type '#{ResourceTypeUIBean.name}'"/>
        </c:when>
        <c:when test="#{not empty param.groupId}">
            <c:set var="title" value="Definition for '#{alertDefinition.name}' on group '#{ResourceGroupUIBean.name}'"/>
        </c:when>
        <c:otherwise>
            <c:set var="title" value="Definition for '#{alertDefinition.name}' on resource '#{alertDefinition.resource.name}'"/>
        </c:otherwise>
    </c:choose>

    <ui:decorate template="/rhq/layout/main.xhtml">
        <ui:param name="pageTitle" value="#{title}"/>


        <ui:define name="metaHeaders">
            <style>
                label {
                    font-weight: bold;
                }

                .col1, .col2 {
                    vertical-align: top;
                    padding: 10px;
                }

                .col1 {
                    width: 35%;
                }

                .col2 {
                    width: 100%;
                }
            </style>
        </ui:define>

        <ui:define name="breadcrumbs">
            <h:outputLink value="/rhq/resource/alert/listAlertDefinitions.xhtml">
                <f:param name="id" value="#{alertDefinition.resource.id}"/>
                <h:outputText>Alert Definitions</h:outputText>
            </h:outputLink>
            <h:outputText> &gt; </h:outputText>
            <c:choose>
                <c:when test="#{not empty param.type}">
                    <h:outputText value=" Definition for alert template '#{alertDefinition.name}' "/>
                    <h:outputText> on Resource Type </h:outputText>
                    <h:outputLink value="/rhq/admin/listAlertTemplates.xhtml?type=${param.type}">
                      <h:outputText value=" #{ResourceTypeUIBean.name}"/>
                    </h:outputLink>
                </c:when>
                <c:when test="#{not empty param.groupId}">
                    <h:outputText> on resource group </h:outputText>
                    <h:outputLink value="/rhq/group/alert/listGroupAlertDefinitions.xhtml?groupId=${param.groupId}">
                      <h:outputText value=" #{ResourceGroupUIBean.name}"/>
                    </h:outputLink>
                </c:when>
                <c:otherwise>
                    <h:outputLink value="viewAlert.xhtml">
                        <f:param name="ad" value="#{alertDefinition.id}" />
                        <h:outputText value=" Definition for '#{alertDefinition.name}' "/>
                    </h:outputLink>
                    <h:outputText> on resource </h:outputText>
                    <h:outputLink value="/rhq/resource/summary/overview.xhtml">
                        <f:param name="id" value="#{alertDefinition.resource.id}" />
                        <h:outputText value=" '#{alertDefinition.resource.name}'" />
                    </h:outputLink>
                </c:otherwise>
            </c:choose>
        </ui:define>

        <ui:define name="body">
            <h:messages showSummary="true"
                       infoClass="InfoBlock"
                       warnClass="WarnBlock"
                       errorClass="ErrorBlock"
                       fatalClass="FatalBlock"
                       layout="table"
                       width="100%"/>

            <h:panelGrid columns="2" width="100%" columnClasses="col1,col2">

                <rich:panel>
                    <f:facet name="header">
                        <h:outputText value="Alert Properties" />
                    </f:facet>

                    <h:panelGrid columns="2" border="1" cellpadding="5" width="100%">
                        <h:outputLabel for="alertName" value="Name:  " />
                        <h:outputText id="alertName" value="#{alertDefinition.name}" />

                        <h:outputLabel for="alertDescription" value="Description:  " />
                        <h:outputText id="alertDescription" value="#{alertDefinition.description}" />

                        <h:outputLabel for="alertPriority" value="Priority:  " />
                        <h:outputText id="alertPriority" value="#{alertDefinition.priority.displayName}" />

                        <h:outputLabel for="alertEnabled" value="Active:  " />
                        <h:outputText id="alertEnabled" value="#{alertDefinition.enabled}" />

                        <h:outputLabel for="alertDateCreated" value="Date Created:  " />
                        <h:outputText id="alertDateCreated" value="#{alertDefinition.ctime}">
                            <f:converter converterId="UserDateTimeConverter" />
                        </h:outputText>

                        <h:outputLabel for="alertDateModified" value="Date Modified:  " />
                        <h:outputText id="alertDateModified" value="#{alertDefinition.mtime}">
                            <f:converter converterId="UserDateTimeConverter" />
                        </h:outputText>
                    </h:panelGrid>

                    <br />
                    <h:outputLink id="editLink" styleClass="buttonmed" value="#">
                        <h:outputText value="Edit '#{alertDefinition.name}' Properties" />
                        <rich:componentControl for="editAlertDefinitionPanel" attachTo="editLink" operation="show" event="onclick" />
                    </h:outputLink>
                </rich:panel>

                <rich:panel>
                    <f:facet name="header">
                        <h:outputText value="Condition Set" />
                    </f:facet>

                    <h3>
                        <h:outputText value="#{messages['alert.config.props.CB.ExpressionDetails.1']} " />
                        <h:outputText value="#{alertDefinition.conditionExpression}" />
                        <h:outputText value=" #{messages['alert.config.props.CB.ExpressionDetails.2']}" />
                    </h3>

                    <rich:dataTable value="#{alertUIBean.alertConditions}" var="condition" cellpadding="20" cellspacing="5">
                        <h:column>
                            <h:outputText value="#{condition}" />
                        </h:column>
                    </rich:dataTable>

                    <h:panelGrid columns="2" cellpadding="5">
                        <h:panelGroup>
                            <strong>
                                <h:outputText value="#{messages['alert.config.props.CB.DampeningRule']}" />
                            </strong>
                        </h:panelGroup>

                        <h:outputText value="#{alertUIBean.alertDampening}" />

                        <h:panelGroup>
                            <strong>
                                <h:outputText value="#{messages['alert.config.props.CB.Content.ActionFilters']}  " />
                            </strong>
                        </h:panelGroup>

                        <h:panelGroup>
                            <h:outputText value="#{messages['alert.config.props.CB.Content.UntilRecovered']}:  " />
                            <strong>
                                <h:outputText value="#{alertDefinition.willRecover}" />
                            </strong>
                        </h:panelGroup>
                    </h:panelGrid>

                    <br /><br />
                    <h:outputLink id="editConditionsLink" styleClass="buttonmed" value="listConditions.xhtml">
                        <f:param name="ad" value="#{param.ad}" />

                        <h:outputText value="Edit Alert Conditions" />
                    </h:outputLink>

                </rich:panel>
            </h:panelGrid>

            <ui:decorate template="notif/listAlertSender.xhtml">
                <ui:param name="redirect" value="/rhq/resource/alert/viewAlert.xhtml?ad=#{param.ad}" />
                <ui:define name="actionButtons">
                    <br /><br />
                    <h:outputLink id="addAlertTemplateLink" styleClass="buttonmed" value="#">
                        <h:outputText value="Add Alert Notifications from Template" />
                        <rich:componentControl for="addAlertFromTemplatePanel"
                                            attachTo="addAlertTemplateLink"
                                            operation="show"
                                            event="onclick" />
                    </h:outputLink>
                </ui:define>
            </ui:decorate>

            <br />
            <br />
            <c:choose>
                <c:when test="#{not empty param.type}">
                    <h:outputLink value="/rhq/admin/listAlertTemplates.xhtml?type=${param.type}">
                        <h:outputText value="Back to Alert Definitions for Resource Type '#{ResourceTypeUIBean.name}'"/>
                    </h:outputLink>
                </c:when>
                <c:when test="#{not empty param.groupId}">
                    <h:outputLink value="/rhq/group/alert/listGroupAlertDefinitions.xhtml?groupId=${param.groupId}">
                        <h:outputText value="Back to Alert Definitions for Resource Group '#{ResourceGroupUIBean.name}'"/>
                    </h:outputLink>
                </c:when>
                <c:otherwise>
                    <h:outputLink value="/rhq/resource/alert/listAlertDefinitions.xhtml">
                        <f:param name="id" value="#{alertDefinition.resource.id}"/>
                        <h:outputText value="Back to Alert Definitions for Resource '#{alertDefinition.resource.name}'"/>
                    </h:outputLink>
                </c:otherwise>
            </c:choose>

            <rich:modalPanel id="addAlertFromTemplatePanel" moveable="false" autosized="true">
                <f:facet name="header">
                    <h:outputText value="Add Alert Notifications from template"/>
                </f:facet>
                <h:form id="newNotificationsFromTemplateForm">
                    <input type="hidden" name="ad" value="${param.ad}"/>

                    <rich:panel rendered="#{definitionNotificationsUIBean.notificationTemplates.size > 0}">
                    <div>
                        <h:selectOneMenu id="templateList" value="#{definitionNotificationsUIBean.selectedTemplate}">
                            <f:selectItems value="#{definitionNotificationsUIBean.notificationTemplates}"/>
                        </h:selectOneMenu>

                        <br/>

                        <h:selectBooleanCheckbox title="clearExisting" value="#{definitionNotificationsUIBean.clearExistingNotifications}"/>
                        <h:outputText value="Clear existing notifications"/>
                    </div>

                    <br />
                    <h:commandButton id="addTemplateButton"
                                   value="Add Alert Notifications"
                                   action="#{definitionNotificationsUIBean.addAlertSenderFromTemplate}"
                                   styleClass="buttonmed"
                                   style="margin-top: auto;">
                    </h:commandButton>
                    </rich:panel>

                    <rich:panel rendered="#{definitionNotificationsUIBean.notificationTemplates.size == 0}">
                        No Alert Notification Templates have been defined yet.<br/>
                        Please create some in Administration -> System Configuration -> AlertNotification Templates
                    </rich:panel>

                    <h:outputLink id="alertTemplateCancelLink" styleClass="buttonmed" value="#" style="float: right; margin: 10px;">
                        <h:outputText value="Cancel" />
                        <rich:componentControl for="addAlertFromTemplatePanel" attachTo="alertTemplateCancelLink" operation="hide" event="onclick" />
                    </h:outputLink>

                </h:form>
            </rich:modalPanel>

            <rich:modalPanel id="editAlertDefinitionPanel" moveable="false" autosized="true">
                <f:facet name="header">
                    <h:outputText value="Edit #{alertDefinition.name} Definition" />
                </f:facet>

                <h:form id="editAlertDefinitionForm">
                    <input type="hidden" name="ad" value="#{param.ad}" />

                    <ui:include src="alertDefinitionProperties.xhtml" />

                    <h:outputLink id="editDefinitionCancelLink" styleClass="buttonmed" value="#" style="float: right;">
                        <h:outputText value="Cancel" />
                        <rich:componentControl for="editAlertDefinitionPanel" attachTo="editDefinitionCancelLink" operation="hide" event="onclick" />
                    </h:outputLink>

                    <h:commandButton id="saveButton" value="Save Changes" styleClass="buttonmed" action="#{alertUIBean.saveAlertDefinition}" />
                </h:form>

            </rich:modalPanel>

        </ui:define>
    </ui:decorate>
</html>
