<!DOCTYPE html>
<html>
  <head>
    <title>Raw mertic last 7 days</title>
    <script type="text/javascript" src="js/d3.js"></script>
    <script type="text/javascript" src="js/d3.layout.js"></script>
    <script type="text/javascript" src="js/d3.time.js"></script>
    <script type="text/javascript" src="js/jquery.js"></script>
    <style type="text/css">

svg {
  width: 960px;
  height: 600px;
  border: solid 1px #ccc;
  font: 10px sans-serif;
  shape-rendering: crispEdges;
}
.axis text
{
	fill: #333;
	font-family: sans-serif;
	font-size: 10px;
}
.axis .domain
{
	opacity: 0;
}
.tick
{
	stroke: #ccc;
    stroke-dasharray: 1 5;
}


    </style>
  </head>
  <body>
  <h1 id="resId">Resource</h1>
  <h2 id="header">Schedule</h2>

  <div id="one"></div>
    <script type="text/javascript">

// Width and height of the chart to print
var w = 960,
    h = 600;

// Get the platforms and then the first one
$.getJSON('/rest/1/resource/platforms.json', function (json) {
    var res = json[0];
    var rid = res.resourceId;
    $("#resId").text("Resource " + rid + " (" + res.resourceName + ")");

    // Now get the metrical schedules of the platform
    $.getJSON("/rest/1/resource/"+rid+"/schedules.json?type=metric", function (json2) {

        // Take the first and render it
        var schId = json2[0].scheduleId;
        $("#header").text("Schedule " + schId + " (" + json2[0].scheduleName + "), base unit: " + json2[0].unit);

        d3.json(
                '/rest/1/metric/data/' + schId + '/raw.json?duration=604800',
                function (jsondata) {

                    var w = 960,
                            h = 600;
                    // compute min/max values for x and y a
                    var minTsD = Number.MAX_VALUE;
                    var maxTsD = Number.MIN_VALUE;
                    var minVal = Number.MAX_VALUE;
                    var maxVal = Number.MIN_VALUE;
                    for (i = 0; i < jsondata.length; i++) {
                        var v = jsondata[i].value;
                        minVal = Math.min(v, minVal);
                        maxVal = Math.max(v, maxVal);
                        var td = jsondata[i].timeStamp;
                        minTsD = Math.min(td, minTsD);
                        maxTsD = Math.max(td, maxTsD);
                    }

                    WIDTH = w;
                    HEIGHT = h;
                    MARGINS = {top: 10, right: 10, bottom: 20, left: 10};

                    var xRange = d3.time.scale().range ([MARGINS.left, WIDTH - MARGINS.right]).domain([new Date(minTsD),new Date(maxTsD)]);
                    var yRange = d3.scale.linear().range ([HEIGHT - MARGINS.top, MARGINS.bottom]).domain([minVal, maxVal]);

                    // X axis range goes from lowest to highest timestamp
                    var x = d3.time.scale().domain([new Date(minTsD),new Date(maxTsD)]).range([50, w-10]); // 50-> make room for label
//var x = xRange;
                    var y = yRange;
                    // Y axis range goes from lowest to highest value
                    //      var y = d3.scale.linear().domain([minVal, maxVal]).rangeRound([0, h]);
                    format = d3.time.format("%H:%M");


                    xAxis = d3.svg.axis() // generate an axis
                            .scale(x) // set the range of the axis
                            .tickSize(10) // height of the ticks
                            .tickSubdivide(true); // display ticks between text labels
                    yAxis = d3.svg.axis() // generate an axis
                            .scale(yRange) // set the range of the axis
                            .tickSize(3) // width of the ticks
                            .orient("right") // have the text labels on the right hand side
                            .tickFormat(d3.format("0e"))
                            .tickSubdivide(true); // display ticks between text labels



                    var svg = d3.select("body").append("svg:svg")
                            .attr("width", w)
                            .attr("height", h);

                    svg.append("svg:g")
                            .attr("class","x axis")
//                            .attr("transform", "translate(0," + (HEIGHT - MARGINS.bottom) + ")")
                            .call(xAxis);

                    svg.append("svg:g")
                            .attr("class","y axis")
                            .attr("transform", "translate(" + (MARGINS.left) + ",0)")
                            .call(yAxis);

                    // Now lets "loop" over the data and show the dots
                    var dot = svg.append("svg:g")
                            .selectAll("dot").data(jsondata)
                            ;

                    dot.enter().append("svg:circle")
                            .attr("cx", function (d) {
                                return x(d.timeStamp);
                            })
                            .attr("cy", function (d) {
                                return y(d.value);
                            })
                            .style("stroke", "blue")
                            .attr("stroke", "blue")
                            .attr("r", 1)



                });

    })
})



    </script>
  </body>
</html>
