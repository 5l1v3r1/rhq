<project
   xmlns="http://maven.apache.org/POM/4.0.0"
   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
   xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd">

   <modelVersion>4.0.0</modelVersion>

   <parent>
      <groupId>org.rhq</groupId>
      <artifactId>rhq-parent</artifactId>
      <version>1.3.0-SNAPSHOT</version>
   </parent>

   <groupId>org.rhq</groupId>
   <artifactId>rhq-client</artifactId>
   <packaging>pom</packaging>

   <name>RHQ Enterprise Remote Client</name>
   <description>RHQ Remote Client</description>

   <scm>
      <connection>scm:svn:http://svn.rhq-project.org/repos/rhq/trunk/modules/enterprise/client/</connection>
      <developerConnection>scm:svn:http://svn.rhq-project.org/repos/rhq/trunk/modules/enterprise/client/</developerConnection>
   </scm>

   <properties>
      <scm.module.path>modules/enterprise/client/</scm.module.path>

      <jline.version>0.9.94</jline.version>
      <i18nlog.version>1.0.9</i18nlog.version>
      <log4j.version>1.2.14</log4j.version>
      <persistence-api.version>1.0</persistence-api.version>
      <hibernate-all.version>1.0.0.Alpha9</hibernate-all.version>
   </properties>

   <dependencies>
      <!-- NOTE: when undefined explicity the version is defined in the root POM's dependencyManagement section. -->

      <!-- Required for WS API Clients or generation -->

      <!-- Currently we are not packaging the JBossWS native distribution. Leave until final decision is made. 
         <dependency>
         <groupId>jboss</groupId>
         <artifactId>jbossws</artifactId>
         <scope>provided</scope>
         <type>zip</type>
         </dependency>
      -->

      <!-- To build the client service endpoint classes we need an AS distribution.  We'll only unzip
         what we jbossws needs and only if we don't already have an uptodate version in the target
         directory.
      -->
      <dependency>
         <groupId>org.jboss.jbossas</groupId>
         <artifactId>jboss-as-dist</artifactId>
         <type>zip</type>
      </dependency>

      <dependency>
         <groupId>jboss</groupId>
         <artifactId>jboss-remoting</artifactId>
      </dependency>

      <dependency>
         <groupId>org.rhq</groupId>
         <artifactId>rhq-enterprise-server</artifactId>
         <version>${project.version}</version>
         <type>ejb</type>
         <scope>compile</scope>
      </dependency>

      <dependency>
         <groupId>org.rhq</groupId>
         <artifactId>rhq-core-domain</artifactId>
         <version>${project.version}</version>
         <type>ejb</type>
         <scope>compile</scope>
      </dependency>

      <!--  This is needed for wsprovide's classpath. I'm not sure why, but it's not provided with jbossws -->
      <dependency>
         <groupId>javax.persistence</groupId>
         <artifactId>persistence-api</artifactId>
         <version>${persistence-api.version}</version>
         <scope>compile</scope>
      </dependency>

      <!-- Required by the CLI  -->
      <dependency>
         <groupId>commons-logging</groupId>
         <artifactId>commons-logging</artifactId>
         <scope>provided</scope>
      </dependency>

      <dependency>
         <groupId>gnu-getopt</groupId>
         <artifactId>getopt</artifactId>
         <scope>provided</scope>
      </dependency>

      <dependency>
         <groupId>i18nlog</groupId>
         <artifactId>i18nlog</artifactId>
         <version>${i18nlog.version}</version>
         <scope>provided</scope>
      </dependency>

      <!-- TODO This can probably go away after we stop using EJB Exception classes in the remote API -->
      <dependency>
         <groupId>jboss</groupId>
         <artifactId>jboss-j2ee</artifactId>
         <scope>provided</scope>
      </dependency>

      <dependency>
         <groupId>jboss</groupId>
         <artifactId>jboss-remoting</artifactId>
         <scope>provided</scope>
      </dependency>

      <dependency>
         <groupId>jline</groupId>
         <artifactId>jline</artifactId>
         <version>${jline.version}</version>
         <scope>provided</scope>
      </dependency>

      <dependency>
         <groupId>log4j</groupId>
         <artifactId>log4j</artifactId>
         <version>${log4j.version}</version>
         <scope>provided</scope>
      </dependency>

      <!-- TODO Remove this if and when this is not needed for compilation -->
      <dependency>
         <groupId>hibernate-annotations</groupId>
         <artifactId>hibernate-annotations</artifactId>
         <scope>compile</scope>
      </dependency>

   </dependencies>

   <build>
      <finalName>rhq-client-${project.version}</finalName>
      <outputDirectory>target/${project.build.finalName}</outputDirectory>

      <plugins>

         <plugin>
            <artifactId>maven-antrun-plugin</artifactId>
            <executions>

               <execution>
                  <id>client-distribution</id>
                  <phase>package</phase>
                  <configuration>
                     <tasks>
                        <ant
                           antfile="${basedir}/src/main/scripts/rhq-client.build.xml"
                           dir="${basedir}"
                           target="prepare-dist"
                           inheritAll="false"
                           inheritRefs="false">

                           <property
                              name="buildNumber"
                              value="${buildNumber}" />
                           <property
                              name="java.jre.home"
                              value="${java.home}" />
                           <property
                              name="maven.compile.classpath"
                              refid="maven.compile.classpath" />
                           <property
                              name="maven.runtime.classpath"
                              refid="maven.runtime.classpath" />
                           <property
                              name="project.build.outputDirectory"
                              value="${project.build.outputDirectory}" />
                           <property
                              name="project.name"
                              value="${project.name}" />
                           <property
                              name="project.groupId"
                              value="${project.groupId}" />
                           <property
                              name="project.version"
                              value="${project.version}" />
                           <property
                              name="settings.localRepository"
                              value="${settings.localRepository}" />
                           <property
                              name="commons-logging.version"
                              value="${commons-logging.version}" />
                           <property
                              name="concurrent.version"
                              value="${concurrent.version}" />
                           <property
                              name="getopt.version"
                              value="${getopt.version}" />
                           <property
                              name="i18nlog.version"
                              value="${i18nlog.version}" />
                           <property
                              name="jboss-common.version"
                              value="${jboss-common.version}" />
                           <property
                              name="jboss.version"
                              value="${jboss.version}" />
                           <property
                              name="jboss-remoting.version"
                              value="${jboss-remoting.version}" />
                           <property
                              name="jbossws.version"
                              value="${jbossws.version}" />
                           <property
                              name="jline.version"
                              value="${jline.version}" />
                           <property
                              name="log4j.version"
                              value="${log4j.version}" />
                           <property
                              name="persistence-api.version"
                              value="${persistence-api.version}" />
                           <property
                              name="rhq.client.build.exclude.cli.jar"
                              value="${rhq.client.build.exclude.cli.jar}" />
                           <property
                              name="rhq.client.build.include.client.jar"
                              value="${rhq.client.build.include.client.jar}" />
                           <!-- 
                              name="hibernate-all.version"
                              value="${hibernate-all.version}" />  -->
                        </ant>
                     </tasks>
                  </configuration>
                  <goals>
                     <goal>run</goal>
                  </goals>
               </execution>

            </executions>
         </plugin>

         <plugin>
            <artifactId>maven-assembly-plugin</artifactId>
            <configuration>
               <descriptors>
                  <descriptor>src/main/scripts/rhq-client.assembly.xml</descriptor>
               </descriptors>
               <finalName>${project.build.finalName}</finalName>
            </configuration>
            <executions>
               <execution>
                  <id>assemble-rhq-client-zip</id>
                  <phase>package</phase>
                  <goals>
                     <goal>attached</goal>
                  </goals>
               </execution>
            </executions>
         </plugin>

      </plugins>
   </build>

   <profiles>
      <!-- 
         Just for running Web Service / Remote API tests. To run the tests execute them explicitly via
         -Dtest=TestRemoteInterface
         If running these tests there are some prerequisites:
         * RHQ Server must be running on localhost:7080.
         * ws-test user defined in database with full permissions
         * RHQ agent running
         *   Non RHQ Server JBossAS in inventory.
         * -Djbossws-native-home= to jbossws native stack install (e.g. jbossws-native-3.0.4.GA.zip)
         * -Dws.test.package-path= to a test .war file for deploy tests
         * -Dws.test.package-version= package version for the test .war fil   
      -->
      <profile>
         <id>ws-dynamic-test</id>

         <activation>
            <property>
               <name>test</name>
               <value>TestRemoteInterface</value>
            </property>
         </activation>

         <dependencies>

            <dependency>
               <groupId>xerces</groupId>
               <artifactId>xercesImpl</artifactId>
               <version>2.8.1</version>
               <scope>provided</scope>
            </dependency>

            <dependency>
               <groupId>jboss</groupId>
               <artifactId>jboss-j2ee</artifactId>
               <!-- NOTE: The version is defined in the root POM's dependencyManagement section. -->
               <scope>provided</scope><!-- by JBossAS -->
            </dependency>

            <dependency>
               <groupId>javax.mail</groupId>
               <artifactId>mail</artifactId>
               <version>1.3.1</version>
               <scope>provided</scope>
            </dependency>

            <dependency>
               <groupId>jboss</groupId>
               <artifactId>javassist</artifactId>
               <scope>provided</scope>
            </dependency>

            <!--
               <dependency>
               <groupId>hibernate-annotations</groupId>
               <artifactId>hibernate-annotations</artifactId>
               <scope>provided</scope>
               </dependency>
               
               
               <dependency>
               <groupId>jboss.jbossws</groupId>
               <artifactId>jboss-jaxws</artifactId>
               <scope>provided</scope>
               </dependency>
               
            -->

         </dependencies>

         <build>
            <plugins>

               <plugin>
                  <artifactId>maven-antrun-plugin</artifactId>
                  <executions>

                     <execution>
                        <id>test-build</id>
                        <phase>test</phase>
                        <configuration>
                           <tasks>
                              <ant
                                 antfile="${basedir}/src/main/scripts/rhq-client.build.xml"
                                 dir="${basedir}"
                                 target="prepare-tests"
                                 inheritAll="false"
                                 inheritRefs="false">

                                 <property
                                    name="java.jre.home"
                                    value="${java.home}" />
                                 <property
                                    name="maven.test.classpath"
                                    refid="maven.test.classpath" />
                                 <property
                                    name="project.build.outputDirectory"
                                    value="${project.build.outputDirectory}" />
                                 <property
                                    name="project.version"
                                    value="${project.version}" />
                              </ant>
                           </tasks>
                        </configuration>
                        <goals>
                           <goal>run</goal>
                        </goals>
                     </execution>

                  </executions>
               </plugin>

               <plugin>
                  <artifactId>maven-surefire-plugin</artifactId>

                  <executions>
                     <execution>
                        <id>test-TestRemoteInterface</id>
                        <phase>test</phase>

                        <configuration>
                           <groups>ws</groups>
                           <includes>
                              <include>TestRemoteInterface.java</include>
                           </includes>
                           <forkMode>pertest</forkMode>
                           <argLine>-Xmx512m -Xms128m</argLine>
                           <additionalClasspathElements>
                              <!-- The below is required for WS Java Client support -->
                              <additionalClasspathElement>target/jboss-${jboss.version}/client/jbossws-client.jar</additionalClasspathElement>
                           </additionalClasspathElements>
                        </configuration>
                        <goals>
                           <goal>test</goal>
                        </goals>
                     </execution>
                  </executions>

               </plugin>
            </plugins>
         </build>
      </profile>

      <profile>
         <id>ws-static-test</id>

         <activation>
            <property>
               <name>test</name>
               <value>ClientMainTest</value>
            </property>
         </activation>

         <build>
            <plugins>
               <plugin>
                  <artifactId>maven-antrun-plugin</artifactId>
                  <executions>

                     <execution>
                        <id>test-build</id>
                        <phase>test</phase>
                        <configuration>
                           <tasks>
                              <ant
                                 antfile="${basedir}/src/main/scripts/rhq-client.build.xml"
                                 dir="${basedir}"
                                 target="prepare-tests"
                                 inheritAll="false"
                                 inheritRefs="false">

                                 <property
                                    name="java.jre.home"
                                    value="${java.home}" />
                                 <property
                                    name="maven.test.classpath"
                                    refid="maven.test.classpath" />
                                 <property
                                    name="project.build.outputDirectory"
                                    value="${project.build.outputDirectory}" />
                                 <property
                                    name="project.version"
                                    value="${project.version}" />
                              </ant>
                           </tasks>
                        </configuration>
                        <goals>
                           <goal>run</goal>
                        </goals>
                     </execution>

                  </executions>
               </plugin>

               <plugin>
                  <artifactId>maven-surefire-plugin</artifactId>
                  <executions>

                     <execution>
                        <id>test-ClientMainTest</id>
                        <phase>test</phase>

                        <configuration>
                           <groups>ws</groups>
                           <includes>
                              <include>ClientMainTest.java</include>
                           </includes>
                           <forkMode>pertest</forkMode>
                           <argLine>-Xmx512m -Xms128m</argLine>
                           <additionalClasspathElements>
                              <!-- The below is required for WS Java Client support -->
                              <additionalClasspathElement>
                                 ${project.build.outputDirectory}/lib/rhq-cli-${project.version}.jar
                              </additionalClasspathElement>
                              <additionalClasspathElement>
                                 ${project.build.outputDirectory}/lib/${project.build.finalName}.jar
                              </additionalClasspathElement>
                           </additionalClasspathElements>
                        </configuration>
                        <goals>
                           <goal>test</goal>
                        </goals>
                     </execution>
                  </executions>
               </plugin>

            </plugins>
         </build>
      </profile>

      <profile>
         <id>dev</id>

         <properties>
            <rhq.client.build.include.client.jar>true</rhq.client.build.include.client.jar>
         </properties>
      </profile>
   </profiles>
</project>
